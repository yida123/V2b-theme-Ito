(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[187],{4569:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>f});var s=a(95155),r=a(59568),i=a(90996),l=a(66749),o=a(74369),n=a(65701),u=a(40933),c=a(99010),d=a(66069),h=a(35695),m=a(12115),p=a(56671);function f(){let e=(0,h.useRouter)(),{sendVerifyCode:t,resetPassword:a}=(0,r.A)(),[f,g]=(0,m.useState)({email:"",timer:-1,isVisible:!1,isVisible1:!1}),w=async()=>{if(!f.email||!f.email.split("@")[0])return p.oR.error("邮箱不能为空");try{await t(f.email),p.oR.success("验证码已发送，请注意查收"),g(e=>({...e,timer:60}))}catch(e){(0,i.A)(e)}},[x,v]=(0,m.useState)(!1);return(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,s.jsxs)("div",{className:"flex w-full max-w-sm flex-col gap-4 rounded-large px-8 pb-10 pt-6",children:[(0,s.jsxs)("p",{className:"pb-4 text-center text-3xl font-semibold",children:["找回密码",(0,s.jsx)("span",{"aria-label":"emoji",className:"ml-2",role:"img",children:"\uD83D\uDD11"})]}),(0,s.jsxs)(l.l,{className:"flex flex-col gap-4",validationBehavior:"native",onSubmit:t=>{t.preventDefault(),p.oR.promise(async()=>{let s=t.currentTarget;try{if(v(!0),s.password.value!==s.password1.value)throw Error("两次输入的密码不一致");await a(f.email,s.password.value,s.verifyCode.value),e.push("/signin")}catch(e){throw e}finally{v(!1)}},{success:"密码已重置，请登录",loading:"重置中...",error:i.A})},children:[(0,s.jsx)(o.r,{autoComplete:"username",isRequired:!0,label:"邮箱",name:"email",placeholder:"请输入您的邮箱",type:"email",variant:"bordered",radius:"full",value:f.email,onValueChange:e=>g(t=>({...t,email:e}))}),(0,s.jsx)(o.r,{autoComplete:"off",isRequired:!0,label:"验证码",name:"verifyCode",placeholder:"点击发送后查看邮箱",type:"text",variant:"bordered",radius:"full",endContent:(0,s.jsx)(n.T,{radius:"full",color:"primary",className:"h-full",isLoading:f.timer>0,spinner:null,onPress:w,children:f.timer<=0?"发送":f.timer.toString()})}),(0,s.jsx)(o.r,{autoComplete:"new-password",isRequired:!0,endContent:(0,s.jsx)("button",{type:"button",onClick:()=>g(e=>({...e,isVisible:!e.isVisible})),children:f.isVisible?(0,s.jsx)(c.A,{weight:"Linear",size:24,className:"text-default-500"}):(0,s.jsx)(d.A,{weight:"Bold",size:24,className:"text-default-500"})}),label:"密码",name:"password",placeholder:"请输入您的密码",type:f.isVisible?"text":"password",variant:"bordered",radius:"full"}),(0,s.jsx)(o.r,{autoComplete:"new-password",isRequired:!0,endContent:(0,s.jsx)("button",{type:"button",onClick:()=>g(e=>({...e,isVisible1:!e.isVisible1})),children:f.isVisible1?(0,s.jsx)(c.A,{weight:"Linear",size:24,className:"text-default-500"}):(0,s.jsx)(d.A,{weight:"Bold",size:24,className:"text-default-500"})}),label:"再次输入密码",name:"password1",placeholder:"请再次输入您的密码",type:f.isVisible1?"text":"password",variant:"bordered",radius:"full"}),(0,s.jsx)("div",{className:"flex w-full items-center justify-between px-1 py-2",children:(0,s.jsx)(u.h,{href:"/signin",size:"sm",children:"返回登录"})}),(0,s.jsx)(n.T,{className:"w-full",color:"primary",type:"submit",radius:"full",isLoading:x,children:!x&&"重置"})]})]})})}},35695:(e,t,a)=>{"use strict";var s=a(18999);a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})},59568:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,O:()=>u});var s=a(95155),r=a(23464),i=a(12115),l=a(60838),o=a(792);let n=(0,i.createContext)(void 0),u=e=>{let{children:t}=e,[a,u]=(0,i.useState)(()=>{let e=localStorage.getItem("auth_data");return{isAuthChecked:!!e,isLoggedIn:!!e}}),[c,d]=(0,i.useState)(),[h,m]=(0,i.useState)();(0,i.useEffect)(()=>{if(!window.settings)return;let{title:e,description:t}=window.settings;document.title="".concat(e," - ").concat(t),window.settings.crisp_id&&o.YH.configure(window.settings.crisp_id),d(window.settings)},[]);let p=(0,i.useMemo)(()=>{if(!c)return;let{api:e}=c,t=r.A.create({baseURL:new URL("/api/v1",e).toString(),timeout:1e4,headers:{"Content-Type":"application/json"}});return t.interceptors.request.use(e=>{let t=localStorage.getItem("auth_data");return t&&(e.headers.Authorization=t),e}),t.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===403&&(localStorage.removeItem("auth_data"),u(e=>({...e,isLoggedIn:!1}))),Promise.reject(e)}),u(e=>({...e,isAuthChecked:!0})),t},[c]),f=(0,i.useCallback)(async e=>{if(!p)return;let{data:t}=await p.get(e);return t},[p]);(0,i.useEffect)(()=>{p&&localStorage.getItem("auth_data")&&(async()=>{try{await p.get("user/checkLogin"),u(e=>({...e,isLoggedIn:!0}))}catch(e){console.error("Failed to check session:",e)}})()},[p]);let g=(0,i.useCallback)(async()=>{if(p&&!h)try{let e=await p.get("guest/comm/config");m(e.data.data)}catch(e){console.error("Failed to load remote config:",e)}},[p,h]),w=async(e,t)=>{if(p)try{let{data:a}=await p.post("passport/auth/login",{email:e,password:t});localStorage.setItem("auth_data",a.data.auth_data),u(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},x=async(e,t,a,s)=>{if(p)try{let{data:r}=await p.post("passport/auth/register",{email:e,password:t,email_code:a,invite_code:s});localStorage.setItem("auth_data",r.data.auth_data),u(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},v=async(e,t,a)=>{if(p)try{await p.post("passport/auth/forget",{email:e,password:t,email_code:a})}catch(e){throw e}},b=async e=>{if(p)try{await p.post("passport/comm/sendEmailVerify",{email:e})}catch(e){throw e}};return(0,s.jsx)(n.Provider,{value:{isAuthChecked:a.isAuthChecked,isLoggedIn:a.isLoggedIn,request:p,config:c,remoteConfig:h,loadRemoteConfig:g,signIn:w,signUp:x,signOut:()=>{localStorage.removeItem("auth_data"),u({isAuthChecked:!0,isLoggedIn:!1})},sendVerifyCode:b,resetPassword:v},children:(0,s.jsx)(l.BE,{value:{fetcher:f,errorRetryCount:1,errorRetryInterval:100},children:t})})},c=()=>{let e=(0,i.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},90996:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(23464);let r=e=>{if(s.A.isAxiosError(e))if(!e.response)return"网络错误，请尝试更换浏览器或者网络环境后再试";else{var t;let a=null==(t=e.response)?void 0:t.data;if(a.message)return a.message}return e instanceof Error?e.message:"未知错误"}},92236:(e,t,a)=>{Promise.resolve().then(a.bind(a,4569))}},e=>{e.O(0,[84,876,895,979,671,369,406,441,964,358],()=>e(e.s=92236)),_N_E=e.O()}]);
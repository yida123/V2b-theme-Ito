(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[182],{24819:(e,t,a)=>{Promise.resolve().then(a.bind(a,80328))},59568:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,O:()=>u});var s=a(95155),r=a(23464),i=a(12115),l=a(60838),o=a(792);let n=(0,i.createContext)(void 0),u=e=>{let{children:t}=e,[a,u]=(0,i.useState)(()=>{let e=localStorage.getItem("auth_data");return{isAuthChecked:!!e,isLoggedIn:!!e}}),[c,d]=(0,i.useState)(),[h,g]=(0,i.useState)();(0,i.useEffect)(()=>{if(!window.settings)return;let{title:e,description:t}=window.settings;document.title="".concat(e," - ").concat(t),window.settings.crisp_id&&o.YH.configure(window.settings.crisp_id),d(window.settings)},[]);let m=(0,i.useMemo)(()=>{if(!c)return;let{api:e}=c,t=r.A.create({baseURL:new URL("/api/v1",e).toString(),timeout:1e4,headers:{"Content-Type":"application/json"}});return t.interceptors.request.use(e=>{let t=localStorage.getItem("auth_data");return t&&(e.headers.Authorization=t),e}),t.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===403&&(localStorage.removeItem("auth_data"),u(e=>({...e,isLoggedIn:!1}))),Promise.reject(e)}),u(e=>({...e,isAuthChecked:!0})),t},[c]),p=(0,i.useCallback)(async e=>{if(!m)return;let{data:t}=await m.get(e);return t},[m]);(0,i.useEffect)(()=>{m&&localStorage.getItem("auth_data")&&(async()=>{try{await m.get("user/checkLogin"),u(e=>({...e,isLoggedIn:!0}))}catch(e){console.error("Failed to check session:",e)}})()},[m]);let f=(0,i.useCallback)(async()=>{if(m&&!h)try{let e=await m.get("guest/comm/config");g(e.data.data)}catch(e){console.error("Failed to load remote config:",e)}},[m,h]),w=async(e,t)=>{if(m)try{let{data:a}=await m.post("passport/auth/login",{email:e,password:t});localStorage.setItem("auth_data",a.data.auth_data),u(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},x=async(e,t,a,s)=>{if(m)try{let{data:r}=await m.post("passport/auth/register",{email:e,password:t,email_code:a,invite_code:s});localStorage.setItem("auth_data",r.data.auth_data),u(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},v=async(e,t,a)=>{if(m)try{await m.post("passport/auth/forget",{email:e,password:t,email_code:a})}catch(e){throw e}},y=async e=>{if(m)try{await m.post("passport/comm/sendEmailVerify",{email:e})}catch(e){throw e}};return(0,s.jsx)(n.Provider,{value:{isAuthChecked:a.isAuthChecked,isLoggedIn:a.isLoggedIn,request:m,config:c,remoteConfig:h,loadRemoteConfig:f,signIn:w,signUp:x,signOut:()=>{localStorage.removeItem("auth_data"),u({isAuthChecked:!0,isLoggedIn:!1})},sendVerifyCode:y,resetPassword:v},children:(0,s.jsx)(l.BE,{value:{fetcher:p,errorRetryCount:1,errorRetryInterval:100},children:t})})},c=()=>{let e=(0,i.useContext)(n);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},80328:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(95155),r=a(59568),i=a(90996),l=a(66749),o=a(74369),n=a(40933),u=a(65701),c=a(99010),d=a(66069),h=a(12115),g=a(56671);function m(){let{signIn:e}=(0,r.A)(),[t,a]=(0,h.useState)(!1),[m,p]=(0,h.useState)(!1);return(0,s.jsx)("div",{className:"flex h-full w-full items-center justify-center",children:(0,s.jsxs)("div",{className:"flex w-full max-w-sm flex-col gap-4 rounded-large px-8 pb-10 pt-6",children:[(0,s.jsxs)("p",{className:"pb-4 text-center text-3xl font-semibold",children:["欢迎回来",(0,s.jsx)("span",{"aria-label":"emoji",className:"ml-2",role:"img",children:"\uD83D\uDC4B"})]}),(0,s.jsxs)(l.l,{className:"flex flex-col gap-4",validationBehavior:"native",onSubmit:t=>{t.preventDefault(),g.oR.promise(async()=>{let a=t.currentTarget;try{p(!0),await e(a.email.value,a.password.value)}catch(e){throw e}finally{p(!1)}},{loading:"登录中...",error:i.A})},children:[(0,s.jsx)(o.r,{autoComplete:"username",isRequired:!0,label:"邮箱",name:"email",placeholder:"请输入您的邮箱",type:"email",variant:"bordered",radius:"full"}),(0,s.jsx)(o.r,{autoComplete:"current-password",isRequired:!0,endContent:(0,s.jsx)("button",{type:"button",onClick:()=>a(!t),children:t?(0,s.jsx)(c.A,{weight:"Linear",size:24,className:"text-default-500"}):(0,s.jsx)(d.A,{weight:"Bold",size:24,className:"text-default-500"})}),label:"密码",name:"password",placeholder:"请输入您的密码",type:t?"text":"password",variant:"bordered",radius:"full"}),(0,s.jsxs)("div",{className:"flex w-full items-center justify-between px-1 py-2",children:[(0,s.jsx)(n.h,{href:"/signup",size:"sm",children:"创建一个账户"}),(0,s.jsx)(n.h,{className:"text-default-500",href:"/forgot",size:"sm",children:"忘记密码？"})]}),(0,s.jsx)(u.T,{className:"w-full",color:"primary",type:"submit",radius:"full",isLoading:m,children:!m&&"登录"})]})]})})}},90996:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(23464);let r=e=>{if(s.A.isAxiosError(e))if(!e.response)return"网络错误，请尝试更换浏览器或者网络环境后再试";else{var t;let a=null==(t=e.response)?void 0:t.data;if(a.message)return a.message}return e instanceof Error?e.message:"未知错误"}}},e=>{e.O(0,[84,876,895,979,671,369,406,441,964,358],()=>e(e.s=24819)),_N_E=e.O()}]);
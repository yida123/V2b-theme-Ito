(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[15],{24933:(e,t,a)=>{"use strict";a.d(t,{n:()=>l});var s=a(95155),r=a(10168);let l=e=>{let{title:t,subtitle:a}=e;return(0,s.jsxs)(r.Z,{fullWidth:!0,radius:"lg",className:"flex flex-col text-left p-4 gap-4 border border-default-200 min-h-[120px] justify-between",shadow:"none",children:[(0,s.jsx)("h1",{className:"text-2xl text-default-700 font-black",children:t}),(0,s.jsx)("h2",{className:"text-xl font-bold text-default-400",children:a})]})}},59568:(e,t,a)=>{"use strict";a.d(t,{A:()=>c,O:()=>d});var s=a(95155),r=a(23464),l=a(12115),i=a(60838),n=a(792);let o=(0,l.createContext)(void 0),d=e=>{let{children:t}=e,[a,d]=(0,l.useState)(()=>{let e=localStorage.getItem("auth_data");return{isAuthChecked:!!e,isLoggedIn:!!e}}),[c,u]=(0,l.useState)(),[h,m]=(0,l.useState)();(0,l.useEffect)(()=>{if(!window.settings)return;let{title:e,description:t}=window.settings;document.title="".concat(e," - ").concat(t),window.settings.crisp_id&&n.YH.configure(window.settings.crisp_id),u(window.settings)},[]);let x=(0,l.useMemo)(()=>{if(!c)return;let{api:e}=c,t=r.A.create({baseURL:new URL("/api/v1",e).toString(),timeout:1e4,headers:{"Content-Type":"application/json"}});return t.interceptors.request.use(e=>{let t=localStorage.getItem("auth_data");return t&&(e.headers.Authorization=t),e}),t.interceptors.response.use(e=>e,e=>{var t;return(null==(t=e.response)?void 0:t.status)===403&&(localStorage.removeItem("auth_data"),d(e=>({...e,isLoggedIn:!1}))),Promise.reject(e)}),d(e=>({...e,isAuthChecked:!0})),t},[c]),g=(0,l.useCallback)(async e=>{if(!x)return;let{data:t}=await x.get(e);return t},[x]);(0,l.useEffect)(()=>{x&&localStorage.getItem("auth_data")&&(async()=>{try{await x.get("user/checkLogin"),d(e=>({...e,isLoggedIn:!0}))}catch(e){console.error("Failed to check session:",e)}})()},[x]);let p=(0,l.useCallback)(async()=>{if(x&&!h)try{let e=await x.get("guest/comm/config");m(e.data.data)}catch(e){console.error("Failed to load remote config:",e)}},[x,h]),f=async(e,t)=>{if(x)try{let{data:a}=await x.post("passport/auth/login",{email:e,password:t});localStorage.setItem("auth_data",a.data.auth_data),d(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},w=async(e,t,a,s)=>{if(x)try{let{data:r}=await x.post("passport/auth/register",{email:e,password:t,email_code:a,invite_code:s});localStorage.setItem("auth_data",r.data.auth_data),d(e=>({...e,isLoggedIn:!0}))}catch(e){throw e}},j=async(e,t,a)=>{if(x)try{await x.post("passport/auth/forget",{email:e,password:t,email_code:a})}catch(e){throw e}},y=async e=>{if(x)try{await x.post("passport/comm/sendEmailVerify",{email:e})}catch(e){throw e}};return(0,s.jsx)(o.Provider,{value:{isAuthChecked:a.isAuthChecked,isLoggedIn:a.isLoggedIn,request:x,config:c,remoteConfig:h,loadRemoteConfig:p,signIn:f,signUp:w,signOut:()=>{localStorage.removeItem("auth_data"),d({isAuthChecked:!0,isLoggedIn:!1})},sendVerifyCode:y,resetPassword:j},children:(0,s.jsx)(i.BE,{value:{fetcher:g,errorRetryCount:1,errorRetryInterval:100},children:t})})},c=()=>{let e=(0,l.useContext)(o);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},90996:(e,t,a)=>{"use strict";a.d(t,{A:()=>r});var s=a(23464);let r=e=>{if(s.A.isAxiosError(e))if(!e.response)return"网络错误，请尝试更换浏览器或者网络环境后再试";else{var t;let a=null==(t=e.response)?void 0:t.data;if(a.message)return a.message}return e instanceof Error?e.message:"未知错误"}},91645:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>I});var s=a(95155),r=a(24933),l=a(59568),i=a(90996),n=a(18850),o=a(65701),d=a(33296),c=a(79761),u=a(29747),h=a(53773),m=a(95604),x=a(58451),g=a(64177),p=a(33183),f=a(43350),w=a(77520),j=a(84520),y=a(1493),b=a(74369),v=a(97376),C=a(47467),N=a(43194),S=a(12115),_=a(56671),A=a(60838);let k=["已邀请用户数","累计获得佣金","确认中的佣金","佣金返现比例","可用佣金余额"];function I(){let{request:e}=(0,l.A)(),{data:t,mutate:a}=(0,A.Ay)("user/invite/fetch"),{data:I}=(0,A.Ay)("user/comm/config"),E=(0,S.useCallback)(e=>{if(!t||!t.data||!t.data.stat)return[0,0,0,0,0][e];let a=t.data.stat;return 3===e?"".concat(a[e],"%"):0===e?a[e]+" 人":"\xa5 "+(a[e]/100).toFixed(2)},[t]),L=async()=>{try{await e.get("user/invite/save"),await a()}catch(e){_.oR.error((0,i.A)(e))}},O=(0,S.useCallback)(()=>{if(!t||!t.data||!t.data.codes||!Array.isArray(t.data.codes))return"";if(0===t.data.codes.length)return L(),"";let e=t.data.codes[0].code;return new URL("/signup?code=".concat(e),window.location.href.split("/").slice(0,3).join("/")).toString()},[t]),[P,R]=(0,S.useState)(1),[W,z]=(0,S.useState)(0),{data:T}=(0,A.Ay)("user/invite/details&current=".concat(P,"&page_size=10"));(0,S.useEffect)(()=>{T&&T.data&&z(Math.ceil(T.total/10))},[T]);let B=(0,S.useCallback)((e,t)=>{let a=e[t];switch(t){case"created_at":let r=new Date(1e3*a);return(0,s.jsx)("p",{className:"text-left",children:new Date(r).toLocaleTimeString("zh-CN",{year:"numeric",month:"short",day:"numeric"})});case"get_amount":return(0,s.jsx)("div",{className:"text-right",children:"\xa5 "+(a/100).toFixed(2)});default:return a}},[]),{isOpen:F,onOpen:V,onOpenChange:q,onClose:U}=(0,n.j)(),[Y,D]=(0,S.useState)(""),[H,K]=(0,S.useTransition)(),M=()=>{K(async()=>{try{if(!Y)throw Error("请输入划转金额");if(isNaN(parseInt(Y)))throw Error("请输入有效的金额");let t=parseInt(Y);await e.post("user/transfer",{transfer_amount:100*t}),await a(),_.oR.success("划转成功")}catch(e){_.oR.error((0,i.A)(e))}finally{U(),D("")}})},{isOpen:X,onOpen:Z,onOpenChange:G,onClose:J}=(0,n.j)(),[Q,$]=(0,S.useState)(""),[ee,et]=(0,S.useState)(new Set([])),[ea,es]=(0,S.useTransition)(),er=()=>{es(async()=>{try{var t;let a=parseInt(null!=(t=ee.anchorKey)?t:"");if(isNaN(a))throw Error("请选择提现方式");if(!Q)throw Error("请输入提现账号");await e.post("user/ticket/withdraw",{withdraw_account:Q,withdraw_method:I.data.withdraw_methods[a]}),_.oR.success("提现申请成功")}catch(e){_.oR.error((0,i.A)(e))}finally{J(),et(new Set([])),$("")}})};return t&&t.data?(0,s.jsxs)("div",{className:"flex flex-col w-full gap-6 sm:gap-12 items-center justify-center",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 w-full",children:[(0,s.jsx)(r.n,{title:(0,s.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,s.jsx)("span",{children:E(4)}),(0,s.jsx)(o.T,{size:"sm",radius:"md",color:"primary",onPress:Z,children:"提现"})]}),subtitle:"当前剩余佣金"}),(0,s.jsx)(r.n,{title:(0,s.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,s.jsx)("span",{children:E(4)}),(0,s.jsx)(o.T,{size:"sm",radius:"md",color:"primary",onPress:V,children:"划转"})]}),subtitle:"当前账户余额"}),(0,s.jsx)("div",{className:"col-span-1 sm:col-span-2",children:(0,s.jsx)(r.n,{title:(0,s.jsx)("div",{className:"flex flex-col items-center gap-2",children:"专属邀请链接"}),subtitle:(0,s.jsx)("div",{className:"flex flex-col items-center gap-2",children:(0,s.jsx)(d._,{size:"sm",variant:"flat",hideSymbol:!0,classNames:{base:"max-w-[95%]",pre:"truncate"},children:O()})})})})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 w-full",children:k.map((e,t)=>{if(t!==k.length-1)return(0,s.jsx)(r.n,{subtitle:e,title:E(t)},t)})}),(0,s.jsxs)(c.j,{"aria-label":"Example table with dynamic content",isStriped:!0,isHeaderSticky:!0,shadow:"none",classNames:{base:"border border-default-200 rounded-large",thead:"[&>tr]:first:shadow-none"},topContent:(0,s.jsx)("span",{className:"text-2xl text-default-700 font-black text-center",children:"邀请返现历史"}),bottomContent:W>0?(0,s.jsx)("div",{className:"flex w-full justify-center",children:(0,s.jsx)(u.T,{isCompact:!0,showControls:!0,showShadow:!0,color:"primary",page:P,total:W,onChange:e=>{e&&e!=P&&R(e)}})}):null,children:[(0,s.jsxs)(h.X,{children:[(0,s.jsx)(m.e,{className:"text-left",children:"邀请时间"},"created_at"),(0,s.jsx)(m.e,{className:"text-right",children:"佣金金额"},"get_amount")]}),(0,s.jsx)(x.E,{isLoading:!T||!T.data,loadingContent:null,emptyContent:"暂无佣金记录",children:T&&T.data&&T.data.map(e=>(0,s.jsx)(g.s,{children:t=>(0,s.jsx)(p.w,{className:"created_at"==t?"text-left":"text-right",children:B(e,t.toLocaleString())})},e.id.toString()))})]}),(0,s.jsx)(f.Y,{isOpen:F,onOpenChange:q,radius:"lg",hideCloseButton:!0,scrollBehavior:"inside",children:(0,s.jsx)(w.g,{children:()=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.c,{children:"推广佣金划转至余额"}),(0,s.jsxs)(y.h,{children:[(0,s.jsx)(d._,{color:"warning",disableCopy:!0,hideCopyButton:!0,hideSymbol:!0,className:"mb-4",children:"划转后的余额仅用于本站消费使用"}),(0,s.jsx)(b.r,{isReadOnly:!0,fullWidth:!0,size:"sm",variant:"bordered",label:"当前推广佣金余额",labelPlacement:"outside",radius:"md",classNames:{input:"text-xs",label:"group-data-[filled-within=true]:text-default-500 text-sm",helperWrapper:"h-4"},defaultValue:E(4).toString()}),(0,s.jsx)(b.r,{fullWidth:!0,size:"sm",variant:"bordered",label:"转划金额",labelPlacement:"outside",placeholder:"请输入需要转划到余额的金额",radius:"md",classNames:{input:"text-xs",label:"group-data-[filled-within=true]:text-default-500 text-sm",helperWrapper:"h-4"},defaultValue:E(4).toString(),value:Y,onValueChange:D})]}),(0,s.jsx)(v.q,{children:(0,s.jsx)(o.T,{fullWidth:!0,radius:"md",color:"primary",onPress:M,isLoading:H,children:"确认"})})]})})}),(0,s.jsx)(f.Y,{isOpen:X,onOpenChange:G,radius:"lg",hideCloseButton:!0,scrollBehavior:"inside",children:(0,s.jsx)(w.g,{children:e=>(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(j.c,{children:"申请提现"}),(0,s.jsxs)(y.h,{children:[(0,s.jsx)(C.d,{fullWidth:!0,size:"sm",variant:"bordered",label:"提现方式",labelPlacement:"outside",placeholder:"请选择提现方式",radius:"md",selectedKeys:ee,onSelectionChange:et,classNames:{value:"text-xs",label:"group-data-[filled=true]:text-default-500 text-sm",helperWrapper:"h-4"},children:I&&I.data&&I.data.withdraw_methods.map((e,t)=>(0,s.jsx)(N.y,{children:e},t.toString()))}),(0,s.jsx)(b.r,{fullWidth:!0,size:"sm",variant:"bordered",label:"提现账号",labelPlacement:"outside",placeholder:"请输入提现账号",radius:"md",classNames:{input:"text-xs",label:"group-data-[filled-within=true]:text-default-500 text-sm",helperWrapper:"h-4"},defaultValue:E(4).toString(),value:Q,onValueChange:$})]}),(0,s.jsx)(v.q,{children:(0,s.jsx)(o.T,{fullWidth:!0,radius:"md",color:"primary",onPress:er,isLoading:ea,children:"确认"})})]})})})]}):null}},91924:(e,t,a)=>{Promise.resolve().then(a.bind(a,91645))}},e=>{e.O(0,[84,876,895,979,671,369,318,216,572,398,174,441,964,358],()=>e(e.s=91924)),_N_E=e.O()}]);